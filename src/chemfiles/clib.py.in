# -* coding: utf-8 -*
import os
import sys
from ctypes import cdll
from chemfiles import ffi


# AUTOMATICALLY GENERATED BY CMAKE
CHEMFILES_LOCATION = "${CHEMFILES_LOCATION}"
# END OF GENERATION


class FindChemfilesLibrary(object):
    def __init__(self):
        self._cache = None

    def __call__(self):
        if self._cache is None:
            try:
                self._cache = cdll.LoadLibrary(lib_path(CHEMFILES_LOCATION))
            except OSError:
                raise ImportError("Could not find chemfiles library.")
            ffi.set_interface(self._cache)
        return self._cache


def lib_path(location):
    """Library file name from the location"""
    if os.path.isfile(location):
        return location

    if sys.platform.startswith("win"):
        return location + ".dll"
    elif sys.platform.startswith("linux"):
        return "lib" + location + ".so"
    elif sys.platform.startswith("darwin"):
        return "lib" + location + ".dylib"
    else:
        raise OSError("Unknown os. Edit this file to add logic for your OS.")
